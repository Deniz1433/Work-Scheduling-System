databaseChangeLog:

  # Role hierarchy table
  - changeSet:
      id: create-role-hierarchy-table
      author: deniz
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: role_hierarchy
      changes:
        - createTable:
            tableName: role_hierarchy
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: parentRole
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: childRole
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
        - addUniqueConstraint:
            tableName: role_hierarchy
            columnNames: parentRole,childRole
            constraintName: uq_role_hierarchy

  # Role node positions
  - changeSet:
      id: create-role-node-position-table
      author: deniz
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: role_node_position
      changes:
        - createTable:
            tableName: role_node_position
            columns:
              - column:
                  name: role
                  type: VARCHAR(100)
                  constraints:
                    primaryKey: true
              - column:
                  name: posX
                  type: DOUBLE
                  constraints:
                    nullable: false
              - column:
                  name: posY
                  type: DOUBLE
                  constraints:
                    nullable: false

  # Department table
  - changeSet:
      id: create-department-table
      author: emir
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: department
      changes:
        - createTable:
            tableName: department
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(36)
                  constraints:
                    nullable: false
              - column:
                  name: minDays
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: childDepartmentId
                  type: BIGINT
                  constraints:
                    nullable: true
        - addForeignKeyConstraint:
            baseTableName: department
            baseColumnNames: childDepartmentId
            constraintName: fk_department_child_department
            referencedTableName: department
            referencedColumnNames: id

  # Permission table
  - changeSet:
      id: create-permission-table
      author: emir
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: permission
      changes:
        - createTable:
            tableName: permission
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(36)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
                  constraints:
                    nullable: false

  # Role table
  - changeSet:
      id: create-role-table
      author: emir
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: role
      changes:
        - createTable: 
            tableName: role
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(36)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
                  constraints:
                    nullable: true
              - column:
                  name: isActive
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: false

  # Role Permission table
  - changeSet:
      id: create-role-permission-table
      author: emir
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: role_permission
      changes:
        - createTable:
            tableName: role_permission
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: roleId
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: permissionId
                  type: BIGINT
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: role_permission
            baseColumnNames: roleId
            constraintName: fk_role_permission_role
            referencedTableName: role
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: role_permission
            baseColumnNames: permissionId
            constraintName: fk_role_permission_permission
            referencedTableName: permission
            referencedColumnNames: id

  # User table
  - changeSet:
      id: create-user-table
      author: emir
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: user
      changes:
        - createTable:
            tableName: user
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: firstName
                  type: VARCHAR(36)
                  constraints:
                    nullable: true
              - column:
                  name: lastName
                  type: VARCHAR(36)
                  constraints:  
                    nullable: true
              - column:
                  name: email
                  type: VARCHAR(36)
                  constraints:
                    nullable: true
              - column:
                  name: username
                  type: VARCHAR(36)
                  constraints:
                    nullable: false
              - column:
                  name: password
                  type: VARCHAR(36)
                  constraints:
                    nullable: true
              - column:
                  name: roleId
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: departmentId
                  type: BIGINT
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: user
            baseColumnNames: roleId
            constraintName: fk_user_role
            referencedTableName: role
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: user
            baseColumnNames: departmentId
            constraintName: fk_user_department
            referencedTableName: department
            referencedColumnNames: id

  # Attendance table
  - changeSet:
      id: create-attendance-table
      author: emir
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: attendance
      changes:
        - createTable:
            tableName: attendance
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: userId
                  type: VARCHAR(36)
                  constraints:
                    nullable: false
              - column:
                  name: weekStart
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: monday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: tuesday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: wednesday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: thursday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: friday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: isApproved
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false

  # Excuse table
  - changeSet:
      id: create-excuse-table
      author: emir
      validCheckSum: ANY
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: excuse
      changes:
        - createTable:
            tableName: excuse
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: userId
                  type: VARCHAR(36)
                  constraints:
                    nullable: false
              - column:
                  name: excuseDate
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: excuseType
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: isApproved
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
