databaseChangeLog:
  # Department table
  - changeSet:
      id: create-department-table
      author: emir
      changes:
        - createTable:
            tableName: department
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: min_days
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: child_department_id
                  type: BIGINT
                  constraints:
                    nullable: true
        - addForeignKeyConstraint:
            baseTableName: department
            baseColumnNames: child_department_id
            constraintName: fk_department_child_department
            referencedTableName: department
            referencedColumnNames: id

  # Permission table
  - changeSet:
      id: create-permission-table
      author: emir
      changes:
        - createTable:
            tableName: permission
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
                  constraints:
                    nullable: false

  # Role table
  - changeSet:
      id: create-role-table
      author: emir
      changes:
        - createTable: 
            tableName: role
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
                  constraints:
                    nullable: true
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: false

  # Role Permission table
  - changeSet:
      id: create-role-permission-table
      author: emir
      changes:
        - createTable:
            tableName: role_permission
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: role_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: permission_id
                  type: BIGINT
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: role_permission
            baseColumnNames: role_id
            constraintName: fk_role_permission_role
            referencedTableName: role
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: role_permission
            baseColumnNames: permission_id
            constraintName: fk_role_permission_permission
            referencedTableName: permission
            referencedColumnNames: id

  # User table
  - changeSet:
      id: create-users-table
      author: emir
      validCheckSum: ANY
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: first_name
                  type: VARCHAR(100)
                  constraints:
                    nullable: true
              - column:
                  name: last_name
                  type: VARCHAR(100)
                  constraints:  
                    nullable: true
              - column:
                  name: email
                  type: VARCHAR(100)
                  constraints:
                    nullable: true
              - column:
                  name: username
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: password
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              - column:
                  name: role_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: department_id
                  type: BIGINT
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: users
            baseColumnNames: role_id
            constraintName: fk_user_role
            referencedTableName: role
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: users
            baseColumnNames: department_id
            constraintName: fk_user_department
            referencedTableName: department
            referencedColumnNames: id

  # Attendance table
  - changeSet:
      id: create-attendance-table
      author: emir
      changes:
        - createTable:
            tableName: attendance
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: week_start
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: monday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: tuesday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: wednesday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: thursday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: friday
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: is_approved
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false

  # Excuse table
  - changeSet:
      id: create-excuse-table
      author: emir
      changes:
        - createTable:
            tableName: excuse
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: excuse_date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: excuse_type
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
                  constraints:
                    nullable: true
              - column:
                  name: is_approved
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false

  # Role hierarchy table
  - changeSet:
      id: create-role-hierarchy-table
      author: emir
      changes:
        - createTable:
            tableName: role_hierarchy
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: parent_role
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: child_role
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
        - addUniqueConstraint:
            tableName: role_hierarchy
            columnNames: parent_role,child_role
            constraintName: uq_role_hierarchy

  # Role node positions
  - changeSet:
      id: create-role-node-position-table
      author: emir
      changes:
        - createTable:
            tableName: role_node_position
            columns:
              - column:
                  name: role
                  type: VARCHAR(100)
                  constraints:
                    primaryKey: true
              - column:
                  name: pos_x
                  type: DOUBLE
                  constraints:
                    nullable: false
              - column:
                  name: pos_y
                  type: DOUBLE
                  constraints:
                    nullable: false

  # Holiday table
  - changeSet:
      id: create-holiday-table
      author: emir
      changes:
        - createTable:
            tableName: holiday
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: end_date
                  type: DATE
                  constraints:  
                    nullable: true
  # Fix sequences for tables with mock data
  - changeSet:
      id: fix-sequences-after-mock-data
      author: emir
      changes:
        - sql:
            sql: SELECT setval('excuse_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM excuse), false);
        - sql:
            sql: SELECT setval('attendance_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM attendance), false);
        - sql:
            sql: SELECT setval('holiday_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM holiday), false);
        - sql:
            sql: SELECT setval('role_hierarchy_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM role_hierarchy), false);
        - sql:
            sql: SELECT setval('department_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM department), false);
        - sql:
            sql: SELECT setval('permission_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM permission), false);
        - sql:
            sql: SELECT setval('role_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM role), false);
        - sql:
            sql: SELECT setval('role_permission_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM role_permission), false);
        - sql:
            sql: SELECT setval('users_id_seq', (SELECT COALESCE(MAX(id), 0) + 1 FROM users), false);

  # User Roles table
  - changeSet:
      id: create-user-roles-table
      author: gpt
      changes:
        - createTable:
            tableName: user_roles
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: role_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: user_roles
            baseColumnNames: role_id
            constraintName: fk_user_roles_role_id
            referencedTableName: role
            referencedColumnNames: id
        - addUniqueConstraint:
            tableName: user_roles
            columnNames: user_id,role_id
            constraintName: uq_user_roles

  # User Departments table
  - changeSet:
      id: create-user-departments-table
      author: gpt
      changes:
        - createTable:
            tableName: user_departments
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: department_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: user_departments
            baseColumnNames: department_id
            constraintName: fk_user_departments_department_id
            referencedTableName: department
            referencedColumnNames: id
        - addUniqueConstraint:
            tableName: user_departments
            columnNames: user_id,department_id
            constraintName: uq_user_departments